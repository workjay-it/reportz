<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Analyzer - Emergency Fix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f1f5f9; font-family: sans-serif; }
        .report-card { background: white; border-top: 6px solid #003087; border-radius: 4px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="p-8">

<div class="max-w-4xl mx-auto">
    <div class="mb-8 border-b border-slate-300 pb-4">
        <h1 class="text-2xl font-black text-slate-800 uppercase">Strategic Analyzer <span class="text-blue-700 underline">v4.0</span></h1>
        <p class="text-xs font-bold text-slate-500 mt-1">Status: <span id="systemStatus" class="text-green-600">System Ready</span></p>
    </div>

    <div class="bg-white p-6 rounded shadow-sm border border-slate-200 mb-8 flex flex-wrap gap-4">
        <select id="sector" class="p-2 border rounded font-bold bg-slate-50">
            <option value="Artificial Intelligence">AI Sector</option>
            <option value="Renewable Energy">Renewable Energy</option>
            <option value="Fintech">Fintech</option>
        </select>
        <select id="country" class="p-2 border rounded font-bold bg-slate-50">
            <option value="USA">United States</option>
            <option value="India">India</option>
            <option value="UK">United Kingdom</option>
        </select>
        <button onclick="generateReport()" id="genBtn" class="bg-[#003087] text-white px-6 py-2 rounded font-bold hover:bg-blue-800">
            GENERATE
        </button>
    </div>

    <div id="loading" class="hidden py-12 text-center">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-blue-900 border-t-transparent mb-4"></div>
        <p class="font-bold text-slate-600">Connecting to Gemini 2.0 Flash...</p>
    </div>

    <div id="reportOutput" class="hidden report-card p-8">
        <div id="reportContent" class="prose max-w-none mb-8"></div>
        <canvas id="growthChart" height="150"></canvas>
    </div>
</div>

<script>
// IMMEDIATE HEALTH CHECK: If you don't see an alert when you load the page, your browser is blocking scripts.
console.log("System Initializing...");

async function generateReport() {
    const sector = document.getElementById('sector').value;
    const country = document.getElementById('country').value;
    const btn = document.getElementById('genBtn');
    const loading = document.getElementById('loading');
    const output = document.getElementById('reportOutput');
    const contentDiv = document.getElementById('reportContent');

    // UI State Reset
    loading.classList.remove('hidden');
    output.classList.add('hidden');
    btn.disabled = true;

    // Use Gemini 2.0 Flash
    const API_KEY = "AIzaSyDWTty5BuvJhZa7bsZszThAFKpDbTjsQDg";
    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{ parts: [{ text: `Generate a market report for ${sector} in ${country}. Format with ## headers.` }] }]
            })
        });

        const data = await response.json();

        if (data.error) throw new Error(data.error.message);

        const text = data.candidates[0].content.parts[0].text;
        
        // Simple Markdown replacement to avoid rendering errors
        contentDiv.innerHTML = text
            .replace(/^## (.*)/gm, '<h2 class="text-xl font-bold text-blue-900 mt-4 mb-2">$1</h2>')
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

        output.classList.remove('hidden');
        renderChart();

    } catch (error) {
        console.error("Critical Error:", error);
        alert("CRITICAL ERROR: " + error.message);
    } finally {
        loading.classList.add('hidden');
        btn.disabled = false;
    }
}

function renderChart() {
    const ctx = document.getElementById('growthChart').getContext('2d');
    // Destroy previous chart if it exists to prevent overlap errors
    if(window.myChart instanceof Chart) { window.myChart.destroy(); }
    
    window.myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['2024', '2025', '2026', '2027', '2028'],
            datasets: [{
                label: 'Projected CAGR',
                data: [10, 22, 38, 55, 71],
                borderColor: '#003087',
                fill: false,
                tension: 0.4
            }]
        }
    });
}
</script>
</body>
</html>
